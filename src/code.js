import { parse } from '@babel/parser';
import traverse from '@babel/traverse';
import generate from '@babel/generator';
import * as t from '@babel/types';
export function transform(src, globals = []) {
    const ast = parse(src, { sourceType: 'module' });
    traverse(ast, {
        ReferencedIdentifier(path) {
            if (t.isIdentifier(path.node) && isUndeclaredVariable(path.scope, path.node.name, globals)) {
                path.replaceWith(t.memberExpression(t.thisExpression(), path.node));
            }
        },
        AssignmentExpression(path) {
            if (t.isIdentifier(path.node.left) && isUndeclaredVariable(path.scope, path.node.left.name, globals)) {
                path.get('left').replaceWith(t.memberExpression(t.thisExpression(), path.node.left));
            }
        },
        FunctionDeclaration(path) {
            if (path.parent.type === 'Program') {
                const functionName = path.node.id;
                if (functionName) {
                    const functionExpression = t.functionExpression(functionName, path.node.params, path.node.body, path.node.generator, path.node.async);
                    const assignment = t.expressionStatement(t.assignmentExpression('=', t.memberExpression(t.thisExpression(), functionName), functionExpression));
                    path.replaceWith(assignment);
                }
            }
        },
        ImportDeclaration(path) {
            const specifiers = path.node.specifiers;
            const source = path.node.source;
            const awaitImport = t.awaitExpression(t.callExpression(t.import(), [source]));
            if (specifiers.length === 0) {
                path.replaceWith(t.expressionStatement(awaitImport));
                return;
            }
            const declarators = specifiers.map(specifier => {
                if (t.isImportSpecifier(specifier)) {
                    return t.objectProperty(specifier.imported, specifier.local, false, specifier.local.name === specifier.imported.name);
                }
                else if (t.isImportDefaultSpecifier(specifier)) {
                    return t.objectProperty(t.identifier('default'), specifier.local);
                }
                else { // ImportNamespaceSpecifier
                    return t.variableDeclarator(specifier.local, awaitImport);
                }
            });
            if (specifiers.some(s => t.isImportNamespaceSpecifier(s))) {
                path.replaceWith(t.variableDeclaration('const', declarators.filter(d => t.isVariableDeclarator(d))));
            }
            else {
                const pattern = t.objectPattern(declarators.filter(d => t.isObjectProperty(d)));
                path.replaceWith(t.variableDeclaration('const', [t.variableDeclarator(pattern, awaitImport)]));
            }
        }
    });
    const body = ast.program.body;
    const lastStatement = body[body.length - 1];
    if (t.isExpressionStatement(lastStatement)) {
        body[body.length - 1] = t.expressionStatement(t.callExpression(t.identifier('display'), [lastStatement.expression]));
    }
    else {
        body.push(t.expressionStatement(t.callExpression(t.identifier('display'), [t.identifier('undefined')])));
    }
    const functionExpression = t.functionExpression(null, [], t.blockStatement(body), false, true);
    return generate(functionExpression).code;
}
export function isUndeclaredVariable(scope, variableName, globals = []) {
    return !scope.hasBinding(variableName) && !globals.includes(variableName);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN0QyxPQUFPLFFBQW1CLE1BQU0saUJBQWlCLENBQUM7QUFDbEQsT0FBTyxRQUFRLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxLQUFLLENBQUMsTUFBTSxjQUFjLENBQUM7QUFJbEMsTUFBTSxVQUFVLFNBQVMsQ0FBQyxHQUFXLEVBQUUsVUFBb0IsRUFBRTtJQUMzRCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFFakQsUUFBUSxDQUFDLEdBQUcsRUFBRTtRQUNaLG9CQUFvQixDQUFDLElBQUk7WUFDdkIsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUMxRixJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDckU7UUFDSCxDQUFDO1FBQ0Qsb0JBQW9CLENBQUMsSUFBSTtZQUN2QixJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsRUFBRTtnQkFDcEcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLGdCQUFn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QyxDQUFDO0lBRS9GLE9BQU8sUUFBUSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzNDLENBQUM7QUFFRCxNQUFNLFVBQVUsb0JBQW9CLENBQ25DLEtBQVksRUFDWixZQUFvQixFQUFFLFVBQW9CLEVBQUU7SUFDM0MsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQzVFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXJzZSB9IGZyb20gJ0BiYWJlbC9wYXJzZXInO1xuaW1wb3J0IHRyYXZlcnNlLCB7IFNjb3BlIH0gZnJvbSAnQGJhYmVsL3RyYXZlcnNlJztcbmltcG9ydCBnZW5lcmF0ZSBmcm9tICdAYmFiZWwvZ2VuZXJhdG9yJztcbmltcG9ydCAqIGFzIHQgZnJvbSAnQGJhYmVsL3R5cGVzJztcblxudHlwZSBQYXJzZVJlc3VsdCA9IFJldHVyblR5cGU8dHlwZW9mIHBhcnNlPjtcblxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybShzcmM6IHN0cmluZywgZ2xvYmFsczogc3RyaW5nW10gPSBbXSkge1xuICBjb25zdCBhc3QgPSBwYXJzZShzcmMsIHsgc291cmNlVHlwZTogJ21vZHVsZScgfSk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgUmVmZXJlbmNlZElkZW50aWZpZXIocGF0aCkge1xuICAgICAgaWYgKHQuaXNJZGVudGlmaWVyKHBhdGgubm9kZSkgJiYgaXNVbmRlY2xhcmVkVmFyaWFibGUocGF0aC5zY29wZSwgcGF0aC5ub2RlLm5hbWUsIGdsb2JhbHMpKSB7XG4gICAgICAgIHBhdGgucmVwbGFjZVdpdGgodC5tZW1iZXJFeHByZXNzaW9uKHQudGhpc0V4cHJlc3Npb24oKSwgcGF0aC5ub2RlKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBBc3NpZ25tZW50RXhwcmVzc2lvbihwYXRoKSB7XG4gICAgICBpZiAodC5pc0lkZW50aWZpZXIocGF0aC5ub2RlLmxlZnQpICYmIGlzVW5kZWNsYXJlZFZhcmlhYmxlKHBhdGguc2NvcGUsIHBhdGgubm9kZS5sZWZ0Lm5hbWUsIGdsb2JhbHMpKSB7XG4gICAgICAgIHBhdGguZ2V0KCdsZWZ0JykucmVwbGFjZVdpdGgodC5tZW1iZXJFeHByZXNzaW9uKHQudGhpc0V4cHJlc3Npb24oKSwgcGF0aC5ub2RlLmxlZnQpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIEZ1bmN0aW9uRGVjbGFyYXRpb24ocGF0aCkge1xuICAgICAgaWYgKHBhdGgucGFyZW50LnR5cGUgPT09ICdQcm9ncmFtJykge1xuICAgICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPSBwYXRoLm5vZGUuaWQ7XG4gICAgICAgIGlmIChmdW5jdGlvbk5hbWUpIHtcbiAgICAgICAgICBjb25zdCBmdW5jdGlvbkV4cHJlc3Npb24gPSB0LmZ1bmN0aW9uRXhwcmVzc2lvbihcbiAgICAgICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgIHBhdGgubm9kZS5wYXJhbXMsXG4gICAgICAgICAgICBwYXRoLm5vZGUuYm9keSxcbiAgICAgICAgICAgIHBhdGgubm9kZS5nZW5lcmF0b3IsXG4gICAgICAgICAgICBwYXRoLm5vZGUuYXN5bmNcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IGFzc2lnbm1lbnQgPSB0LmV4cHJlc3Npb25TdGF0ZW1lbnQoXG4gICAgICAgICAgICB0LmFzc2lnbm1lbnRFeHByZXNzaW9uKFxuICAgICAgICAgICAgICAnPScsXG4gICAgICAgICAgICAgIHQubWVtYmVyRXhwcmVzc2lvbih0LnRoaXNFeHByZXNzaW9uKCksIGZ1bmN0aW9uTmFtZSksXG4gICAgICAgICAgICAgIGZ1bmN0aW9uRXhwcmVzc2lvblxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcGF0aC5yZXBsYWNlV2l0aChhc3NpZ25tZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgSW1wb3J0RGVjbGFyYXRpb24ocGF0aCkge1xuICAgICAgY29uc3Qgc3BlY2lmaWVycyA9IHBhdGgubm9kZS5zcGVjaWZpZXJzO1xuICAgICAgY29uc3Qgc291cmNlID0gcGF0aC5ub2RlLnNvdXJjZTtcblxuICAgICAgY29uc3QgYXdhaXRJbXBvcnQgPSB0LmF3YWl0RXhwcmVzc2lvbih0LmNhbGxFeHByZXNzaW9uKHQuaW1wb3J0KCksIFtzb3VyY2VdKSk7XG5cbiAgICAgIGlmIChzcGVjaWZpZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBwYXRoLnJlcGxhY2VXaXRoKHQuZXhwcmVzc2lvblN0YXRlbWVudChhd2FpdEltcG9ydCkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlY2xhcmF0b3JzID0gc3BlY2lmaWVycy5tYXAoc3BlY2lmaWVyID0+IHtcbiAgICAgICAgaWYgKHQuaXNJbXBvcnRTcGVjaWZpZXIoc3BlY2lmaWVyKSkge1xuICAgICAgICAgIHJldHVybiB0Lm9iamVjdFByb3BlcnR5KHNwZWNpZmllci5pbXBvcnRlZCwgc3BlY2lmaWVyLmxvY2FsLCBmYWxzZSwgc3BlY2lmaWVyLmxvY2FsLm5hbWUgPT09IHNwZWNpZmllci5pbXBvcnRlZC5uYW1lKTtcbiAgICAgICAgfSBlbHNlIGlmICh0LmlzSW1wb3J0RGVmYXVsdFNwZWNpZmllcihzcGVjaWZpZXIpKSB7XG4gICAgICAgICAgcmV0dXJuIHQub2JqZWN0UHJvcGVydHkodC5pZGVudGlmaWVyKCdkZWZhdWx0JyksIHNwZWNpZmllci5sb2NhbCk7XG4gICAgICAgIH0gZWxzZSB7IC8vIEltcG9ydE5hbWVzcGFjZVNwZWNpZmllclxuICAgICAgICAgIHJldHVybiB0LnZhcmlhYmxlRGVjbGFyYXRvcihzcGVjaWZpZXIubG9jYWwsIGF3YWl0SW1wb3J0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChzcGVjaWZpZXJzLnNvbWUocyA9PiB0LmlzSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyKHMpKSkge1xuICAgICAgICBwYXRoLnJlcGxhY2VXaXRoKHQudmFyaWFibGVEZWNsYXJhdGlvbignY29uc3QnLCBkZWNsYXJhdG9ycy5maWx0ZXIoZCA9PiB0LmlzVmFyaWFibGVEZWNsYXJhdG9yKGQpKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcGF0dGVybiA9IHQub2JqZWN0UGF0dGVybihkZWNsYXJhdG9ycy5maWx0ZXIoZCA9PiB0LmlzT2JqZWN0UHJvcGVydHkoZCkpKTtcbiAgICAgICAgcGF0aC5yZXBsYWNlV2l0aCh0LnZhcmlhYmxlRGVjbGFyYXRpb24oJ2NvbnN0JywgW3QudmFyaWFibGVEZWNsYXJhdG9yKHBhdHRlcm4sIGF3YWl0SW1wb3J0KV0pKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IGJvZHkgPSBhc3QucHJvZ3JhbS5ib2R5O1xuICBjb25zdCBsYXN0U3RhdGVtZW50ID0gYm9keVtib2R5Lmxlbmd0aCAtIDFdO1xuXG4gIGlmICh0LmlzRXhwcmVzc2lvblN0YXRlbWVudChsYXN0U3RhdGVtZW50KSkge1xuICAgIGJvZHlbYm9keS5sZW5ndGggLSAxXSA9IHQuZXhwcmVzc2lvblN0YXRlbWVudCh0LmNhbGxFeHByZXNzaW9uKHQuaWRlbnRpZmllcignZGlzcGxheScpLCBbbGFzdFN0YXRlbWVudC5leHByZXNzaW9uXSkpO1xuICB9IGVsc2Uge1xuICAgIGJvZHkucHVzaCh0LmV4cHJlc3Npb25TdGF0ZW1lbnQodC5jYWxsRXhwcmVzc2lvbih0LmlkZW50aWZpZXIoJ2Rpc3BsYXknKSwgW3QuaWRlbnRpZmllcigndW5kZWZpbmVkJyldKSkpO1xuICB9XG5cbiAgY29uc3QgZnVuY3Rpb25FeHByZXNzaW9uID0gdC5mdW5jdGlvbkV4cHJlc3Npb24obnVsbCwgW10sIHQuYmxvY2tTdGF0ZW1lbnQoYm9keSksIGZhbHNlLCB0cnVlKTtcblxuICByZXR1cm4gZ2VuZXJhdGUoZnVuY3Rpb25FeHByZXNzaW9uKS5jb2RlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNVbmRlY2xhcmVkVmFyaWFibGUoXG5cdHNjb3BlOiBTY29wZSxcblx0dmFyaWFibGVOYW1lOiBzdHJpbmcsIGdsb2JhbHM6IHN0cmluZ1tdID0gW10pIHtcbiAgcmV0dXJuICFzY29wZS5oYXNCaW5kaW5nKHZhcmlhYmxlTmFtZSkgJiYgIWdsb2JhbHMuaW5jbHVkZXModmFyaWFibGVOYW1lKTtcbn1cbiJdfQ==